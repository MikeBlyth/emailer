# Emailer Script

This Ruby script is designed to send personalized HTML emails with attachments to a list of recipients from an Excel file, utilizing the Proton Bridge for secure email delivery.

## Features

*   **Personalized Emails:** Generates emails with dynamic content based on recipient data.
*   **Attachments:** Automatically attaches a header photo and a PDF document to each email.
*   **Proton Bridge Integration:** Configured to send emails via a local Proton Bridge SMTP server for enhanced privacy.
*   **Recipient Management:** Reads recipient email addresses, first names, and last names from an Excel spreadsheet.
*   **Interactive Menu:** Provides options to generate a local HTML preview, send a test email, or broadcast to the entire list.

## Requirements

*   Ruby (tested with a recent version, e.g., 2.7+)
*   Bundler (for managing Ruby gems)
*   Proton Bridge (running locally and configured to expose an SMTP server on `127.0.0.1:1025`)

## Setup

1.  **Clone the repository:**
    ```bash
    git clone [repository_url]
    cd emailer
    ```

2.  **Install dependencies:**
    ```bash
    bundle install
    ```
    This will install the required gems: `mail`, `dotenv`, and `creek`.

3.  **Configure environment variables:**
    Create a `.env` file in the project root with your Proton Bridge credentials:
    ```
    PROTON_BRIDGE_USER=your_proton_email@proton.me
    PROTON_BRIDGE_PASS=your_proton_bridge_password
    ```
    *Note: Your Proton Bridge password is not your regular Proton Mail password. It's usually generated by the Bridge application itself.*

4.  **Prepare your assets:**
    Ensure the following files are in the same directory as the script, or update their paths in `send_email.rb`:
    *   `header_photo.jpg`: The image to be embedded in the email.
    *   `Christmas Letter 2025.pdf`: The PDF document to be attached.
    *   `message_fragment.html`: An HTML snippet that forms the body of your email. This file should contain placeholders for dynamic content (e.g., `{{NAME}}`).
    *   `C:\Users\Mike\Dropbox\Current Work\Email News Contact List Addresses.xlsx`: Your Excel file containing recipient data. The script expects email in column `B`, first name in column `C`, and last name in column `D` of the first sheet.

## Usage

Run the script from your terminal:

```bash
ruby send_email.rb
```

You will be presented with a menu:

1.  **Generate local HTML file for review:** Creates `preview_full.html` in the current directory. This allows you to inspect the HTML structure. *Note: Inline images (CID attachments) will likely not display correctly in a local browser preview; they are designed for email clients.*
2.  **Send test email to YOURSELF only:** Sends a test email to `mjblyth@proton.me` (this can be changed in the script).
3.  **Send to WHOLE list:** Broadcasts the email to all recipients listed in the Excel file. This option requires a confirmation prompt.

## Configuration Details

The following constants in `send_email.rb` can be modified:

*   `SMTP_CONFIG`: SMTP server settings (primarily for Proton Bridge).
*   `DOC_LINK`: A URL used within the email content.
*   `PHOTO_FILE`: Path to the header image.
*   `PDF_FILE`: Path to the PDF attachment.
*   `HTML_FRAGMENT`: Path to the HTML message body fragment.
*   `EXCEL_FILE`: Path to the Excel contact list.

## How HTML is Constructed

The `build_html_body` function (not explicitly shown in the provided `send_email.rb` but implied by its use) is responsible for assembling the final HTML. It likely:

1.  Reads the content of `message_fragment.html`.
2.  Replaces `{{NAME}}` (or similar) placeholders with the recipient's first name.
3.  Inserts the `inline_cid` for the header photo.
4.  Includes the `DOC_LINK`.

Ensure your `message_fragment.html` is structured to correctly use these injected values.
